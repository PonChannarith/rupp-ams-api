name: Telegram Commit Alert

on:
  push:
    branches:
      - main
      - develop
      - deploy  # Add any other branches you want alerts for

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram commit alert
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_ACTOR: ${{ github.actor }}
          GITHUB_REF_NAME: ${{ github.ref_name }}
          COMMIT_SHA: ${{ github.sha }}
        run: |
          # Get commit details
          COMMIT_DETAILS=$(git log -1 --pretty=format:"â€¢ Author: %an%nâ€¢ Email: %ae%nâ€¢ Commit ID: %H%nâ€¢ Message: %s%nâ€¢ Date: %ad" $COMMIT_SHA)
          COMMIT_URL="https://github.com/${GITHUB_REPOSITORY}/commit/${COMMIT_SHA}"

          # Build the Telegram message
          MESSAGE="ğŸš€ New Commit Alert by *${GITHUB_ACTOR}* ğŸš€

ğŸ“„ Commit Message:
  $(git log -1 --pretty=format:'%s' $COMMIT_SHA)

ğŸŒ¿ Branch:
  ${GITHUB_REF_NAME}

ğŸ“‚ Repository:
  ${GITHUB_REPOSITORY}

ğŸ”— View Commit:
  [Click here to see the changes](${COMMIT_URL})

ğŸ•’ Timestamp:
  $(git log -1 --pretty=format:'%cI' $COMMIT_SHA)

ğŸ“ Commit Details:
  ${COMMIT_DETAILS}"
  
  # Send the message to Telegram
  curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage" \
  -d chat_id=${TELEGRAM_CHAT_ID} \
  -d parse_mode=Markdown \
  -d text="$MESSAGE"
